<script setup lang="ts">
import { RouterLink } from "vue-router";

import { Routes } from "../router";

import { DeviceType, DeviceStatus } from "../models";

import SectionCard from './SectionCard.vue';
import SlideSwitch from './SlideSwitch.vue';

const props = defineProps<{
  deviceId: string,
  name: string,
  type: DeviceType,
  status: DeviceStatus,
}>();

// const output = defineModel<string>();

const emits = defineEmits<{
  (e: "update", status: DeviceStatus.ACTIVE | DeviceStatus.INACTIVE): void;
}>();

function update(value: boolean) {
  emits("update", value ? DeviceStatus.ACTIVE : DeviceStatus.INACTIVE);
}
</script>

<template>
  <SectionCard class="device-card" :status="status">
    <RouterLink :to="{ name: Routes.DEVICE, params: { deviceId } }" class="full-height">
      <div>
        <h2>{{ name }}</h2>
      </div>
    </RouterLink>
      <div class="bottom-wrap">
        <SlideSwitch v-if="type != DeviceType.SmartHub"
          @update="v => update(v)"
          :value="status == DeviceStatus.ACTIVE" />
        <div v-else></div>
        <div class="device-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path v-if="type == DeviceType.SmartPlug"
              d="M10.625 18.775L8.7 20.65C8.43333 20.9167 8.1125 21.0458 7.7375 21.0375C7.3625 21.0292 7.04167 20.8917 6.775 20.625C6.50833 20.3583 6.375 20.0375 6.375 19.6625C6.375 19.2875 6.50833 18.9667 6.775 18.7L10.625 14.85V13.375H9.15L5.3 17.225C5.03333 17.4917 4.7125 17.625 4.3375 17.625C3.9625 17.625 3.63333 17.4833 3.35 17.2C3.08333 16.9333 2.95 16.6167 2.95 16.25C2.95 15.8833 3.08333 15.5667 3.35 15.3L5.225 13.375H2.975C2.59167 13.375 2.27083 13.2417 2.0125 12.975C1.75417 12.7083 1.625 12.3833 1.625 12C1.625 11.6167 1.75833 11.2917 2.025 11.025C2.29167 10.7583 2.61667 10.625 3 10.625H5.225L3.35 8.725C3.08333 8.45833 2.95417 8.1375 2.9625 7.7625C2.97083 7.3875 3.10833 7.06667 3.375 6.8C3.64167 6.53333 3.9625 6.4 4.3375 6.4C4.7125 6.4 5.03333 6.53333 5.3 6.8L9.15 10.625H10.625V9.15L6.775 5.325C6.50833 5.05833 6.375 4.7375 6.375 4.3625C6.375 3.9875 6.51667 3.65833 6.8 3.375C7.06667 3.10833 7.38333 2.975 7.75 2.975C8.11667 2.975 8.43333 3.10833 8.7 3.375L10.625 5.225V3C10.625 2.61667 10.7583 2.29167 11.025 2.025C11.2917 1.75833 11.6167 1.625 12 1.625C12.3833 1.625 12.7083 1.75833 12.975 2.025C13.2417 2.29167 13.375 2.61667 13.375 3V5.225L15.275 3.375C15.5417 3.10833 15.8625 2.97917 16.2375 2.9875C16.6125 2.99583 16.9333 3.13333 17.2 3.4C17.4667 3.66667 17.6 3.9875 17.6 4.3625C17.6 4.7375 17.4667 5.05833 17.2 5.325L13.375 9.15V10.625H14.85L18.675 6.8C18.9417 6.53333 19.2625 6.4 19.6375 6.4C20.0125 6.4 20.3417 6.54167 20.625 6.825C20.8917 7.09167 21.025 7.40833 21.025 7.775C21.025 8.14167 20.8917 8.45833 20.625 8.725L18.775 10.625H21C21.3833 10.625 21.7083 10.7583 21.975 11.025C22.2417 11.2917 22.375 11.6167 22.375 12C22.375 12.3833 22.2417 12.7083 21.975 12.975C21.7083 13.2417 21.3833 13.375 21 13.375H18.775L20.625 15.3C20.8917 15.5667 21.0208 15.8875 21.0125 16.2625C21.0042 16.6375 20.8667 16.9583 20.6 17.225C20.3333 17.4917 20.0125 17.625 19.6375 17.625C19.2625 17.625 18.9417 17.4917 18.675 17.225L14.85 13.375H13.375V14.85L17.2 18.7C17.4667 18.9667 17.6 19.2875 17.6 19.6625C17.6 20.0375 17.4583 20.3667 17.175 20.65C16.9083 20.9167 16.5917 21.05 16.225 21.05C15.8583 21.05 15.5417 20.9167 15.275 20.65L13.375 18.775V21.025C13.375 21.4083 13.2417 21.7292 12.975 21.9875C12.7083 22.2458 12.3833 22.375 12 22.375C11.6167 22.375 11.2917 22.2417 11.025 21.975C10.7583 21.7083 10.625 21.3833 10.625 21V18.775Z" />
            <path v-else-if="type == DeviceType.SmartHub"
              d="M7.67505 21.275V20.325C5.95838 19.5084 4.57088 18.2917 3.51255 16.675C2.45422 15.0584 1.92505 13.2417 1.92505 11.225C1.92505 9.82502 2.18755 8.51669 2.71255 7.30002C3.23755 6.08336 3.95422 5.01669 4.86255 4.10002C5.77088 3.18336 6.83755 2.46252 8.06255 1.93752C9.28755 1.41252 10.5917 1.15002 11.975 1.15002C13.3584 1.15002 14.6625 1.41252 15.8875 1.93752C17.1125 2.46252 18.1834 3.18336 19.1 4.10002C20.0167 5.01669 20.7417 6.08336 21.275 7.30002C21.8084 8.51669 22.075 9.82502 22.075 11.225C22.075 13.2417 21.5459 15.0584 20.4875 16.675C19.4292 18.2917 18.0417 19.5084 16.325 20.325V21.275C16.325 21.7084 16.1709 22.0792 15.8625 22.3875C15.5542 22.6959 15.1834 22.85 14.75 22.85C14.3167 22.85 13.9459 22.6959 13.6375 22.3875C13.3292 22.0792 13.175 21.7084 13.175 21.275V21.225C12.975 21.2584 12.775 21.2792 12.575 21.2875C12.375 21.2959 12.175 21.3 11.975 21.3C11.775 21.3 11.5792 21.2959 11.3875 21.2875C11.1959 21.2792 11.0084 21.2584 10.825 21.225V21.275C10.825 21.7084 10.6709 22.0792 10.3625 22.3875C10.0542 22.6959 9.68338 22.85 9.25005 22.85C8.81672 22.85 8.44588 22.6959 8.13755 22.3875C7.82922 22.0792 7.67505 21.7084 7.67505 21.275ZM10 9.45002H14C14.4167 9.45002 14.7709 9.30419 15.0625 9.01252C15.3542 8.72086 15.5 8.36669 15.5 7.95002C15.5 7.53336 15.3542 7.17919 15.0625 6.88752C14.7709 6.59586 14.4167 6.45002 14 6.45002H10C9.58338 6.45002 9.22922 6.59586 8.93755 6.88752C8.64588 7.17919 8.50005 7.53336 8.50005 7.95002C8.50005 8.36669 8.64588 8.72086 8.93755 9.01252C9.22922 9.30419 9.58338 9.45002 10 9.45002ZM10.375 14.575C10.0917 14.8584 9.95005 15.1959 9.95005 15.5875C9.95005 15.9792 10.1084 16.3334 10.425 16.65C10.7084 16.9334 11.0625 17.075 11.4875 17.075C11.9125 17.075 12.2667 16.9334 12.55 16.65L13.75 15.45C14.0667 15.1334 14.225 14.7584 14.225 14.325C14.225 13.8917 14.0667 13.5167 13.75 13.2L13.625 13.075C13.9084 12.7917 14.05 12.4542 14.05 12.0625C14.05 11.6709 13.8917 11.3167 13.575 11C13.2917 10.7167 12.9375 10.575 12.5125 10.575C12.0875 10.575 11.7334 10.7167 11.45 11L10.25 12.2C9.93338 12.5167 9.77505 12.8917 9.77505 13.325C9.77505 13.7584 9.93338 14.1334 10.25 14.45L10.375 14.575Z" />
          </svg>
        </div>
      </div>
    </SectionCard>
</template>

<style scoped>
.device-card {
  aspect-ratio: 1;
  /* max-width: calc(50vw - 20px); */
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.device-card .full-height {
  flex-grow: 2;
}

.bottom-wrap {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
}

.device-icon {
  width: 40px;
  height: 40px;
  /* background: white; */
}

.device-icon svg {
  width: 100%;
  height: 100%;
  filter: var(--icon-neu);
}

.device-icon path {
  fill: var(--primary);
}

.device-card[status="ACTIVE"] {
  color: white;
  background: var(--primary);

}

.device-card[status="ACTIVE"] .device-icon > svg {
  filter: var(--darkened-icon-neu);
}

.device-card[status="ACTIVE"] .device-icon path {
  fill: white;
}

a {
  text-decoration: none;
  color: inherit;
}
</style>